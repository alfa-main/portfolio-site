"use strict";var currentData,api={key:"c882b0f6a36922a1f07b646fc11a8131",base:"https://api.openweathermap.org/data/2.5/"},temperatureUnit="˚",humidityUnit=" %",pressureUnit=" мм. рт. ст.",windUnit=" м/с",selectCity=document.querySelector(".search__byselect"),cityName=["Пекин","Лондон","Мадрид","Берлин","Москва","Киев","Минск","Лос-Анджелес","Рим","Варшава","Загреб","Абу-Даби"];function searchBySelect(){for(var e=0;e<cityName.length;e++){var t=document.createElement("option");t.innerHTML=cityName[e],t.value=cityName[e],selectCity.appendChild(t)}}searchBySelect(),selectCity.onchange=function(){getData(this.value)};var searchbox=document.querySelector(".search__box");function setQuery(e){13==e.keyCode&&(""!=searchbox.value?getData(searchbox.value):showModal())}function getData(e){fetch("".concat(api.base,"forecast?q=").concat(e,"&APPID=").concat(api.key)).then((function(e){return e.json()})).then(displayResults).catch((function(){console.log("error")}))}function displayResults(e){console.log(e),"404"==e.cod?showModal():(currentData=e,render(e),periodicTasks())}function convertPressure(e){return(e/1.33).toFixed()}function getValueWithUnit(e,t){return"".concat(e).concat(t)}function getTemperature(e){return getValueWithUnit((e-273).toFixed(),temperatureUnit)}function render(e){renderCity(e),renderCurrentTemperature(e),renderCurrentDescription(e),renderForecast(e),renderDetails(e),renderDayOrNight(e)}function renderCity(e){document.querySelector(".current__city").innerHTML=e.city.name}function renderCurrentTemperature(e){var t=e.list[0].main.temp;document.querySelector(".current__temperature").innerHTML=getTemperature(t)}function renderCurrentDescription(e){var t=e.list[0].weather[0].description;document.querySelector(".current__description").innerHTML=t}function renderForecast(e){for(var t=document.querySelector(".forecast"),n="",r=5;r<38;r+=8){var c=e.list[r],o=c.weather[0].icon,i=getTemperature(c.main.temp),a=getValueWithUnit(c.dt_txt[8],c.dt_txt[9]);n+='<div class="forecast__item">\n        <div class="forecast__time">'.concat(a,'</div>\n        <div class="forecast__icon icon__').concat(o,'"></div>\n        <div class="forecast__temperature">').concat(i,"</div>\n      </div>")}t.innerHTML=n}function renderDetails(e){var t=e.list[0],n=getValueWithUnit(convertPressure(t.main.pressure),pressureUnit),r=getValueWithUnit(t.main.humidity,humidityUnit),c=getTemperature(t.main.feels_like),o=getValueWithUnit(t.wind.speed,windUnit);renderDetailsItem("feelslike",c),renderDetailsItem("humidity",r),renderDetailsItem("pressure",n),renderDetailsItem("wind",o)}function renderDetailsItem(e,t){document.querySelector(".".concat(e)).querySelector(".details__value").innerHTML=t}function isDay(e){var t=1e3*e.city.sunrise,n=1e3*e.city.sunset,r=Date.now();return r>t&&r<n}function renderDayOrNight(e){var t=isDay(e)?"day":"night";transition(),document.documentElement.setAttribute("data-theme",t),document.querySelectorAll(".search__byselect option").forEach((function(e){"night"==t?e.classList.add("night"):e.classList.remove("night")})),document.querySelectorAll(".modal__wrapper").forEach((function(e){"night"==t?e.classList.add("night"):e.classList.remove("night")}))}function periodicTasks(){setInterval(displayResults,6e6),setInterval((function(){console.log(currentData),renderDayOrNight(currentData)}),6e4)}function transition(){document.documentElement.classList.add("transition"),setTimeout((function(){document.documentElement.classList.remove("transition")}),4e3)}function closeModal(){document.querySelectorAll(".modal").forEach((function(e){e.classList.add("hide")})),document.onkeydown=null,searchbox.removeAttribute("readonly","readonly")}function showModal(){document.querySelectorAll(".modal").forEach((function(e){e.classList.remove("hide"),document.onkeydown=function(e){27==e.keyCode&&closeModal()},searchbox.setAttribute("readonly","readonly")}))}searchbox.addEventListener("keypress",setQuery),document.querySelector(".search__btn").onclick=function(){getData(searchbox.value)},document.querySelectorAll(".close__btn").forEach((function(e){e.onclick=closeModal})),document.querySelectorAll(".modal").forEach((function(e){e.onclick=closeModal})),document.querySelector(".modal__wrapper").onclick=function(e){e.stopPropagation()};